---
- name: Update and upgrade Ubuntu packages
  hosts: nodes
  become: true
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Upgrade all packages
      apt:
        upgrade: dist
        autoremove: yes
        autoclean: yes

    - name: Install master ssh key to nodes
      authorized_key:
        user: "{{ansible_user}}"
        state: present
        key: "{{ lookup('file', SSH_KEY_PATH) }}"

  roles:
    - name: k8s_iptables